<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="RestMapper">
	<resultMap type="Rest" id="RestResultMap">
		<result property="reName" column="RE_NAME" />
	</resultMap>
		<resultMap type="RestInfo" id="RestInfoMap">
		<result property="reName" column="RE_NAME" />
	</resultMap>

	<update id="insertRest" parameterType="java.util.List">
			insert into rest (RENO,	RE_NAME, READDR, REIMAGE, REPHONE, REURL, REINFO, CHECKIN, CHECKOUT, RTOTAL, PTOTAL, PSTATUS, REFACILITY, CLICK)
			select REST_SEQ.NEXTVAL as reSeq, T.*
			from(
			<foreach collection="list" item="item" index="index" separator="UNION ALL  ">			
			select  #{item.reName}, #{item.reAddr}, #{item.reImage}, #{item.rePhone}, #{item.reUrl}, #{item.reInfo}, #{item.checkIn},
			#{item.checkout}, #{item.rTotal}, #{item.pTotal}, #{item.pStatus}, #{item.reFacility}, 0
			from SYS.DUAL
			</foreach> 
			)T

	</update>
	
		<update id="selectRooms" parameterType="java.util.List">
			insert into room (RNO, RENO,	RONAME, ROPRICE, PLIMIT, PMAXCOUNT, ROINFO, ROFACILITY, ROSIZE, ROCOUNT, ROIMAGE)
			select ROOM_SEQ.NEXTVAL as roSeq, T.*
			from(
			<foreach collection="list" item="item" index="index" separator="UNION ALL  ">			
			select  #{item.reNo}, #{item.roName}, #{item.roPrice}, #{item.pLimit}, #{item.pMaxCount}, #{item.roInfo}, #{item.roFacility}, #{item.roSize}, #{item.roCount},
			#{item.roImage}
			from SYS.DUAL
			</foreach> 
			)T

	</update>
	
	<select id="selectList" resultMap="RestResultMap">
		select * from rest
		order by 2
	</select>
	
<!-- 		<select id="roomList" resultType="room">
		select * from rest join room using(reNo) where re_name=#{reName}; 
	</select> -->
	
	<select id="getListCount" resultType="int">
		select count(*)
		from rest
	</select>
	
	<select id="selectRoomList"  resultMap="RestInfoMap">
		select * from room join rest using(reNo)
		where reNo = #{reNo}
		order by 1
	</select>
	<!-- MainPage(김승태) -->
	<select id="selectAllRest" resultMap="RestResultMap">
		select * from rest
	</select>
	<select id="selectAllRoom" resultType="Room">
		select * from room
	</select>
	
	<select id="roomInfo" resultType="Room">
		select * from room
		where rNo = #{rNo}
	</select>
	
	<update id="addCount">
		update rest set click = click + 1
		where reNo = #{reNo}
	</update>

	<!-- 숙소명 조회 -->
	<select id="SearchrName" resultMap="RestResultMap">
		select * from rest
		where re_name like '%' || #{searchName} || '%'
	</select>
	
	<!-- 숙소 가격 조회 -->
	<select id="SearchPrice" resultMap="RestInfoMap">
		select rest.re_name, min(room.roPrice)as rowMin, rest.rePhone, rest.READDR, rest.RENO, rest.REIMAGE
		from rest join room on rest.reNo = room.RENO
		where room.roprice between #{minPrice} and #{maxPrice}
		group by rest.re_name, rest.rePhone, rest.READDR, rest.reNo, rest.REIMAGE order by rest.RE_NAME
	</select>
	
		<!-- 정렬 join-->
	<select id="alignList"  resultMap="RestInfoMap">
		<if test="alignList == 'Name'">
		select * from rest order by re_name
		</if>
		<if test="alignList == 'Price'">
		select
		rest.re_Name, min(room.roPrice)as rowMin, rest.rePhone, rest.reAddr, rest.reImage
		from rest join room on rest.reNo = room.RENO
		group by rest.re_Name, rest.rePhone, rest.reAddr, rest.reImage
		order by rowMin, re_Name
		</if>
		<if test="alignList == 'Click'">
		select
		rest.re_Name, rest.CLICK, rest.rePhone, rest.reAddr, rest.reImage
		from rest join room on rest.reNo = room.RENO
		group by rest.CLICK, rest.re_name, rest.rePhone, rest.reAddr, rest.reImage
		order by rest.CLICK desc
		</if>
	</select>
	
	<!-- 지역조회 -->
	<select id="searchLocal" resultMap="RestInfoMap">
		select
		rest.re_name, min(room.roPrice) as rowMin, rest.rePhone, rest.READDR, rest.RENO, rest.REIMAGE
		from rest join room on rest.reNo = room.RENO
		where reAddr like '%'||#{location}||'%' group by rest.re_name, rest.rePhone, rest.READDR, rest.RENO, rest.REIMAGE
	</select>

</mapper>